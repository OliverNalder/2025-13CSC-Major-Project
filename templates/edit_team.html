<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
      .dropbtn {
      padding: 16px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }

    #myInput {
      box-sizing: border-box;
      font-size: 16px;
      padding: 14px 20px 12px 45px;
      border: none;
      border-bottom: 1px solid #ddd;
    }

    #myInput:focus { outline: 3px solid #ddd; }

    .dropdownbutton {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f6f6f6;
      min-width: 230px;
      overflow: auto;
      border: 1px solid #ddd;
      z-index: 1;
    }

    .dropdown-content button {
      width: 100%;
      background: none;
      border: none;
      padding: 12px 16px;
      text-align: left;
      cursor: pointer;
    }

    .dropdown-content button:hover {
      background-color: #ddd;
    }

    .show {
      display: block;
    }

    td button {
      margin-left: 10px;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
    }
    </style>
</head>
<body>
  <body>


    <div class="nav_menu">

    </div>
    <header>
        <div class="top-bar">
            <div class="hamburger" onclick="toggleSidebar()">
                &#9776;
            </div>
            <a href="https://wealthpoint.co.nz/"><img src="/static/__LogoCMYK NOBLYINE (1).png" alt="Logo" class="logo" /></a>
        </div>
    </header>

    <div class="container">
        <nav id="sidebar">
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/data-input">Data Input</a></li>
                <li class="dropdown">
                    <a href="#" onclick="toggleDropdown(this)">Reports</a>
                    <ul class="submenu">
                        <li><a href="/report">All Team</a></li>
                        <li class="dropdown">
                          <a href="#" onclick="toggleDropdown(this)">Individuals</a>
                          <ul class="submenu">
                              {% for member in team_members %}
                                <li><a href="/report/{{member}}">{{member}}</a></li>
                              {% endfor %}
                          </ul>
                        </li>
                        
                        <li><a href="/report_old">Previous Years</a></li>
                        
                    </ul>
                </li>
                <li><a href="/team_manager">Team Management</a></li>
                <li><a href="/signout">Sign Out</a></li>
            </ul>
        </nav>

  <main id="content">      
    <form method="POST">
        <input type="text" name="team_name" value="{{ team_name }}">
        <table border="1">
          <tr><th>Members</th></tr>
          <tbody>
              {% for member in current_members %}
              <tr>
                  <td>
                      {{ member }}
                      <button type="button" onclick="removeExistingMember(this, '{{ member }}')">Remove</button>
                      <input type="hidden" name="members" value="{{ member }}">
                  </td>
              </tr>
              {% endfor %}
          </tbody>
          <tr>
              <td>
                  <div class="dropdownbutton">
                      <button onclick="toggleDropdownmenu()" class="dropbtn" type="button">Add Member</button>
                      <div id="myDropdown" class="dropdown-content">
                          <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
                          {% for user in all_users %}
                              {% if user not in current_members %}
                                  <button type="button" onclick="addMember(event)" id="{{ user }}">{{ user }}</button>
                              {% endif %}
                          {% endfor %}
                      </div>
                  </div>
              </td>
          </tr>
        </table>
        <button type="submit">Save Changes</button>
    </form>
  </main>

<script>
function toggleSidebar() {
 document.getElementById("sidebar").classList.toggle("open");
}

function toggleDropdown(el) {
  el.nextElementSibling.classList.toggle("open");
}


function toggleDropdownmenu() {
  document.getElementById("myDropdown").classList.toggle("show");
}

function filterFunction() {
  const input = document.getElementById("myInput");
  const filter = input.value.toUpperCase();
  const div = document.getElementById("myDropdown");
  const buttons = div.getElementsByTagName("button");
  for (let i = 0; i < buttons.length; i++) {
    const txtValue = buttons[i].textContent || buttons[i].innerText;
    buttons[i].style.display = txtValue.toUpperCase().includes(filter) ? "" : "none";
  }
}

function addMember(event) {
  event.preventDefault();
  const memberId = event.target.id;
  const tableBody = document.querySelector("tbody");

  
  const row = document.createElement("tr");
  const cell = document.createElement("td");
  cell.textContent = memberId;

  const removeBtn = document.createElement("button");
  removeBtn.type = "button";
  removeBtn.textContent = "Remove";
  removeBtn.onclick = function () {
    row.remove();
    input.remove();
    event.target.style.display = "";
  };

  const input = document.createElement("input");
  input.type = "hidden";
  input.name = "members";
  input.value = memberId;

  cell.appendChild(removeBtn);
  row.appendChild(cell);
  tableBody.appendChild(row);
  document.querySelector("form").appendChild(input);

 
  event.target.style.display = "none";
}

function removeExistingMember(button, memberId) {
  const row = button.closest("tr");
  const inputs = document.getElementsByName("members");

  
  for (let i = 0; i < inputs.length; i++) {
    if (inputs[i].value === memberId) {
      inputs[i].remove();
      break;
    }
  }

  row.remove();

  
  const dropdownButtons = document.querySelectorAll("#myDropdown button");
  dropdownButtons.forEach(btn => {
    if (btn.id === memberId) {
      btn.style.display = "";
    }
  });
}
</script>
</body>
</html>